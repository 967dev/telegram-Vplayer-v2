<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sonic Glow | Premium Web Radio & Music Player</title>
    <meta name="description"
        content="Experience music like never before with Sonic Glow. Premium silk visualizers, global radio stations, and seamless local playback in a stunning glassmorphism interface.">
    <meta name="keywords" content="music player, online radio, audio visualizer, web audio, pwa, sonic glow">
    <meta name="theme-color" content="#8b5cf6">

    <!-- PWA and Icons -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://placehold.co/180x180/1f2937/8b5cf6?text=SG">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.2/color-thief.umd.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary-color-rgb: 139, 92, 246;
            --secondary-color-rgb: 219, 39, 119;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        body {
            font-family: 'SF Mono', 'Menlo', 'Monaco', 'Consolas', 'Liberation Mono', 'Courier New', monospace;
            background-color: #000;
            overflow: hidden;
            overscroll-behavior: none;
        }

        input[type=range] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 5px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            outline: none;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #f3f4f6;
            cursor: pointer;
            border-radius: 50%;
        }

        #image-bg {
            position: fixed;
            top: -5%;
            left: -5%;
            width: 110%;
            height: 110%;
            z-index: 1;
            background-size: cover;
            top: -10vh;
            left: -10vw;
            width: 120vw;
            height: 120vh;
            z-index: 1;
            background-size: cover;
            background-position: center;
            display: none;
            transition: transform 0.1s ease-out;
            will-change: transform;
        }

        #video-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1;
            object-fit: cover;
            display: none;
            border: none;
            margin: 0;
            padding: 0;
        }

        #bg-blur-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 2;
            pointer-events: none;
            backdrop-filter: blur(12px);
            background-color: rgba(0, 0, 0, 0.4);
            transition: opacity 0.5s ease-in-out;
            opacity: 1;
        }

        body.playlist-collapsed #bg-blur-overlay {
            opacity: 0;
        }

        #app::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2;
        }

        #visualizerCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 3;
            pointer-events: auto;
            /* Changed to auto for clicks */
        }

        @keyframes heartbeat {
            0% {
                transform: scale(1);
            }

            25% {
                transform: scale(1.3);
            }

            50% {
                transform: scale(1);
            }

            75% {
                transform: scale(1.2);
            }

            100% {
                transform: scale(1);
            }
        }

        .heart-pop {
            animation: heartbeat 0.45s ease-out;
        }

        .marquee-wrapper {
            white-space: nowrap;
            overflow: hidden;
            width: 100%;
        }

        .is-scrolling .marquee-text {
            display: inline-block;
            padding-left: 100%;
            animation: marquee 12s linear infinite;
        }

        @keyframes marquee {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(-100%);
            }
        }

        #mainContent {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 10;
            overflow: visible;
        }

        .playlist-view,
        .radio-view {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1), opacity 0.4s ease;
            will-change: transform, opacity;
        }

        .playlist-view {
            padding: 130px 1rem 160px 1rem;
            overflow-y: auto;
        }

        .radio-view {
            overflow: visible;
            /* Fade out items at the top and bottom boundaries to clear header and footer */
            mask-image: linear-gradient(to bottom,
                    transparent 120px,
                    black 220px,
                    black calc(100% - 200px),
                    transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom,
                    transparent 120px,
                    black 220px,
                    black calc(100% - 200px),
                    transparent 100%);
        }

        .radio-stack {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        /* State Classes on Body */
        body.state-main .playlist-view {
            transform: translateX(-100%);
            opacity: 0;
            pointer-events: none;
        }

        body.state-main .radio-view {
            transform: translateX(100%);
            opacity: 0;
            pointer-events: none;
        }

        body.state-main #bg-blur-overlay {
            opacity: 0;
            pointer-events: none;
        }

        body.state-playlist .playlist-view {
            transform: translateX(0);
            opacity: 1;
            pointer-events: auto;
        }

        body.state-playlist .radio-view {
            transform: translateX(100%);
            opacity: 0;
            pointer-events: none;
        }

        body.state-playlist #bg-blur-overlay {
            opacity: 1;
            pointer-events: auto;
        }

        body.state-radio .playlist-view {
            transform: translateX(-100%);
            opacity: 0;
            pointer-events: none;
        }

        body.state-radio .radio-view {
            transform: translateX(0);
            opacity: 1;
            pointer-events: auto;
        }

        body.state-radio #bg-blur-overlay {
            opacity: 1;
            pointer-events: auto;
        }

        .radio-wheel-item {
            position: absolute;
            left: 50%;
            width: 85%;
            height: 75px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.4s, box-shadow 0.4s;
            background: rgba(10, 10, 10, 0.85);
            /* Slightly more solid */
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 18px;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            padding: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            will-change: transform, opacity;
            pointer-events: auto;
            opacity: 0.4;
            /* Stronger base opacity */
        }

        .accent-bg {
            background-color: rgb(var(--primary-color-rgb));
            transition: background-color 0.5s ease;
        }

        .accent-bg:hover {
            background-color: rgb(var(--primary-color-rgb)) !important;
            filter: brightness(1.2);
        }

        /* Strong Glow for active items */
        .radio-wheel-item.accent-bg-lite,
        .radio-wheel-item.accent-bg-lite-paused {
            background-color: rgba(15, 15, 15, 0.9) !important;
            border-color: rgba(var(--primary-color-rgb), 1) !important;
            box-shadow: 0 0 30px -2px rgba(var(--primary-color-rgb), 0.8) !important;
            opacity: 1 !important;
            z-index: 200;
        }

        .accent-bg-lite-paused {
            background-color: rgba(var(--primary-color-rgb), 0.2);
            border-color: rgba(var(--primary-color-rgb), 0.4);
        }

        /* Styles for collapsed player state */
        #player.collapsed {
            transform: translateY(calc(100% - 75px)) !important;
        }

        #player.collapsed #playerCollapseBtn {
            transform: scaleY(-1);
        }

        #player.collapsed #progressWrapper,
        #player.collapsed #volumeSlider,
        #player.collapsed .gap-6,
        #player.collapsed .gap-3 {
            display: none;
        }

        #player.collapsed .flex.items-center {
            padding-bottom: 5px;
        }

        /* ----- STYLES FOR SEARCH ----- */
        .search-result-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: background 0.2s;
        }

        .search-result-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Modern Radio Stack Styles */
        /* Removed Redundant Container Styles */

        /* Updated Hidden Rule */
        .hidden-screen {
            display: none !important;
        }

        .radio-stack {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            pointer-events: none;
            /* Items inside handle events */
        }

        /* Corrected Radio Wheel Item Positioning */

        .radio-wheel-item.active {
            border-color: rgba(var(--primary-color-rgb), 0.5);
            box-shadow: 0 0 25px -5px rgba(var(--primary-color-rgb), 0.6);
            z-index: 200;
        }

        .radio-wheel-item:not(.active) {
            z-index: 150;
        }

        /* Removed old collapsed styles */

        #bg-blur-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 5;
            pointer-events: none;
            background-color: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            transition: opacity 0.5s ease-in-out;
            opacity: 1;
            will-change: opacity, backdrop-filter;
        }

        body.no-blur #bg-blur-overlay {
            backdrop-filter: none !important;
        }

        body.playlist-collapsed #bg-blur-overlay {
            opacity: 0;
        }

        /* Styles for collapsed player state */
        #player.collapsed {
            transform: translateY(calc(100% - 70px)) !important;
        }

        #player.collapsed #playerCollapseBtn {
            transform: translate(-50%, 30px) scaleY(-1);
        }

        #player.collapsed #progressWrapper,
        #player.collapsed #volumeSlider,
        #player.collapsed .gap-6,
        #player.collapsed .gap-3 {
            opacity: 0;
            pointer-events: none;
            height: 0;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        #player.collapsed .flex.items-center {
            padding-bottom: 5px;
        }

        #playerCollapseBtn {
            transition: transform 0.3s ease, background 0.2s;
        }

        #app {
            z-index: 10;
        }

        #bg-blur-overlay {
            z-index: 5;
        }

        #image-bg,
        #video-bg {
            z-index: 1;
        }
    </style>
</head>

<body class="text-white antialiased">

    <div id="image-bg"></div>
    <video id="video-bg" playsinline autoplay muted loop></video>
    <div id="bg-blur-overlay"></div>
    <div id="particles-js"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; display: none;"></div>

    <div id="app" class="relative flex flex-col h-screen max-w-md mx-auto bg-transparent shadow-2xl overflow-hidden">
        <canvas id="visualizerCanvas"></canvas>
        <header class="relative p-4 bg-transparent z-[500] text-center">
            <div class="flex justify-center items-center gap-2 mb-4">
                <button id="modePlaylistBtn"
                    class="accent-bg text-white font-bold py-2 px-5 rounded-full transition-colors">My Music</button>
                <button id="modeRadioBtn"
                    class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-5 rounded-full transition-colors">Radio</button>
            </div>
            <div class="flex justify-center items-center gap-2 flex-wrap">
                <button id="togglePlaylistBtn" title="Toggle Playlist"
                    class="accent-bg text-white font-bold py-3 px-4 rounded-full transition-colors flex-shrink-0">
                    <i class="fas fa-bars"></i>
                </button>
                <label for="audioUpload"
                    class="accent-bg cursor-pointer text-white font-bold py-3 px-6 rounded-full transition-colors inline-flex items-center gap-2 shadow-lg">
                    <i class="fas fa-plus"></i>
                    <span>Add</span>
                </label>
                <input type="file" id="audioUpload" accept="audio/*" multiple class="hidden">

                <button id="toggleEqBtn" title="Toggle Equalizer"
                    class="accent-bg text-white font-bold py-3 px-4 rounded-full transition-colors flex-shrink-0">
                    <i class="fas fa-wave-square"></i>
                </button>
                <button id="toggleFavoritesBtn" title="Show Favorites"
                    class="accent-bg text-white font-bold py-3 px-4 rounded-full transition-colors flex-shrink-0">
                    <i class="fas fa-heart"></i>
                </button>
                <button id="changeBgBtn" title="Change Background"
                    class="accent-bg text-white font-bold py-3 px-4 rounded-full transition-colors flex-shrink-0">
                    <i class="fas fa-image"></i>
                </button>
            </div>
        </header>

        <main id="mainContent">
            <div id="playlistContainer" class="playlist-view">
                <div id="initialMessage"
                    class="flex flex-col items-center justify-center h-full text-gray-200 text-center pt-20">
                    <i class="fas fa-upload text-6xl mb-4"></i>
                    <p class="text-lg">Upload your music</p>
                    <p class="text-sm">Your playlist is empty</p>
                </div>
            </div>

            <div id="radioContainer" class="radio-view">
                <!-- Stack will be injected here by JS -->
            </div>
        </main>


        <footer id="player"
            class="fixed bottom-0 left-0 right-0 bg-black/60 backdrop-blur-2xl border-t border-white/10 p-4 max-w-md mx-auto rounded-t-3xl transition-transform duration-500 ease-out translate-y-full z-30">
            <!-- Collapse Button will be injected here by JS -->
            <div class="flex items-center">
                <img id="currentTrackArt" src="https://placehold.co/64x64/1f2937/4b5563?text=Music"
                    class="w-16 h-16 rounded-lg shadow-md mr-4 flex-shrink-0">
                <div class="flex-grow w-0 min-w-0">
                    <div id="currentTrackTitleWrapper" class="marquee-wrapper">
                        <p id="currentTrackTitle" class="font-bold marquee-text">Select a Track</p>
                    </div>
                    <p id="currentTrackArtist" class="text-sm text-gray-400 truncate">Nothing is playing</p>
                </div>
                <!-- Radio Favorite Toggle -->
                <button id="footerFavBtn"
                    class="ml-4 text-white/50 hover:text-red-500 transition-colors text-2xl flex-shrink-0">
                    <i class="fas fa-heart"></i>
                </button>
            </div>
            <div id="progressWrapper" class="flex items-center gap-2 text-xs text-gray-400 mt-3">
                <span id="currentTime">0:00</span>
                <input type="range" id="progressBar" value="0" max="100" class="flex-grow">
                <span id="totalTime">0:00</span>
            </div>
            <div class="flex items-center justify-center gap-6 mt-2">
                <button id="prevBtn" class="text-gray-300 hover:text-white transition-colors text-2xl"><i
                        class="fas fa-backward-step"></i></button>
                <button id="playPauseBtn"
                    class="accent-bg transition-colors w-16 h-16 rounded-full flex items-center justify-center text-3xl shadow-lg">
                    <i id="playIcon" class="fas fa-play"></i>
                    <i id="pauseIcon" class="fas fa-pause hidden"></i>
                </button>
                <button id="nextBtn" class="text-gray-300 hover:text-white transition-colors text-2xl"><i
                        class="fas fa-forward-step"></i></button>
            </div>
            <div class="flex items-center gap-3 mt-4 px-6 pb-2">
                <i class="fas fa-volume-low text-gray-400"></i>
                <input type="range" id="volumeSlider" min="0" max="100" value="75" class="flex-grow">
                <i class="fas fa-volume-high text-gray-400"></i>
            </div>
            <audio id="audioPlayer" crossOrigin="anonymous"></audio>
        </footer>
    </div>

    <div id="bgModal"
        class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
        <div class="bg-gray-900 border border-gray-700 rounded-lg shadow-xl w-full max-w-sm max-h-full flex flex-col">
            <h2 class="text-lg font-bold p-4 border-b border-gray-700">Select Background</h2>
            <div class="p-4 border-b border-gray-700">
                <label for="bgUpload"
                    class="w-full text-center cursor-pointer bg-green-600 hover:bg-green-500 p-2 rounded-lg transition-colors block">
                    <i class="fas fa-upload"></i> Upload from device
                </label>
                <input type="file" id="bgUpload" accept="image/*,video/*" class="hidden">
            </div>
            <div id="bgGrid" class="grid grid-cols-3 gap-2 p-4 overflow-y-auto"></div>
            <div class="p-4 border-t border-gray-700">
                <button id="closeBgModal"
                    class="w-full bg-red-600 hover:bg-red-500 p-2 rounded-lg transition-colors">Close</button>
            </div>
        </div>
    </div>

    <script src="js/particles.min.js"></script>
    <script src="js/main.js" type="module"></script>
</body>

</html>